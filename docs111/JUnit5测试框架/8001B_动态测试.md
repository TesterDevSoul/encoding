# åŠ¨æ€æµ‹è¯•

JUnit5 DynamicTest

## æ¦‚å¿µ

åŠ¨æ€æµ‹è¯•æ˜¯ JUnit 5 ä¸­å¼•å…¥çš„ä¸€ç§æ–°çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå…·ä½“çš„æ˜¯JUnit Jupiterå¼•å…¥çš„ä¸€ç§å…¨æ–°çš„æµ‹è¯•ç¼–ç¨‹æ¨¡å‹ã€‚è¿™ç§æ–°çš„æµ‹è¯•å°±æ˜¯åŠ¨æ€æµ‹è¯•ï¼Œå®ƒæ˜¯ç”±@TestFactoryæ³¨è§£çš„å·¥å‚æ–¹æ³•åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ã€‚

æœ¬ç¯‡æ–‡ç« ï¼Œå°†äº†è§£åŠ¨æ€æµ‹è¯•åˆ°åº•æ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•åˆ›å»ºã€‚

æˆ‘ä»¬å·²ç»çŸ¥é“åœ¨æµ‹è¯•ç”¨ä¾‹ç›¸å…³çš„æ–¹æ³•ä¸Šç›´æ¥æ·»åŠ @Testæ³¨è§£å°±å¯ä»¥è¿è¡Œè¯¥æ–¹æ³•ã€‚

- é‚£åŠ¨æ€æµ‹è¯•å’Œå®ƒåˆæœ‰ä»€ä¹ˆä¸åŒç‚¹å‘¢ï¼Ÿ
- ä¸ºä»€ä¹ˆä¼šæœ‰åŠ¨æ€æµ‹è¯•å‘¢ï¼Ÿ
- ç›´æ¥ç”¨Testæ³¨è§£ä¸å°±å¯ä»¥äº†å—ï¼Ÿ

ä¸‹é¢æˆ‘ä»¬å¸¦ç€è¿™äº›ç–‘é—®ğŸ¤”ï¸å»å­¦ä¹ åŠ¨æ€æµ‹è¯•ã€‚

## ä»€ä¹ˆæ˜¯åŠ¨æ€æµ‹è¯•

åŠ¨æ€æµ‹è¯•æ˜¯æŒ‡åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹çš„æµ‹è¯•æ–¹æ³•ã€‚

å®ƒä¸ä¼ ç»Ÿçš„**é™æ€æµ‹è¯•**ä¸åŒï¼Œä¼ ç»Ÿçš„**é™æ€**æµ‹è¯•éœ€è¦åœ¨**ç¼–å†™æµ‹è¯•ä»£ç æ—¶å°†æµ‹è¯•ç”¨ä¾‹å…¨éƒ¨å†™å¥½**ï¼Œè€Œ**åŠ¨æ€**æµ‹è¯•åˆ™å¯ä»¥**åœ¨è¿è¡Œæ—¶æ ¹æ®éœ€è¦åŠ¨æ€ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹**ã€‚

åŠ¨æ€æµ‹è¯•é€šå¸¸ä½¿ç”¨å‚æ•°åŒ–æµ‹è¯•ã€æµ‹è¯•å·¥å‚å’Œæµ‹è¯•æ¨¡æ¿ç­‰æŠ€æœ¯å®ç°ã€‚åŠ¨æ€æµ‹è¯•çš„**ä¼˜ç‚¹**æ˜¯å¯ä»¥**å‡å°‘æµ‹è¯•ä»£ç çš„ç¼–å†™é‡**ï¼ŒåŒæ—¶å¯ä»¥æµ‹è¯•æ›´å¤šçš„æµ‹è¯•ç”¨ä¾‹ï¼Œå¢åŠ æµ‹è¯•è¦†ç›–ç‡ã€‚


>åŠ¨æ€æµ‹è¯•ï¼šå°±æ˜¯DynamicTeståœ¨è¿è¡Œçš„æ—¶å€™åŠ¨æ€çš„ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ã€‚ç”±@TestFactoryæ³¨è§£å£°æ˜çš„æ–¹æ³•ã€‚

>é™æ€æµ‹è¯•ï¼š@Testæ³¨è§£çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå› ä¸ºè¯¥ç”¨ä¾‹åœ¨ç¼–è¯‘æ—¶å·²ç»å®Œå…¨æŒ‡å®šå¥½çš„ã€‚


## åŠ¨æ€æµ‹è¯•ä¸é™æ€æµ‹è¯•åŒºåˆ«

åŠ¨æ€æµ‹è¯•å’Œé™æ€æµ‹è¯•çš„ä¸»è¦åŒºåˆ«åœ¨äºæµ‹è¯•ç”¨ä¾‹çš„ **ç”Ÿæˆæ–¹å¼** å’Œ **æ—¶æœº** ä¸åŒã€‚

é™æ€æµ‹è¯•æ˜¯åœ¨ç¼–å†™æµ‹è¯•ä»£ç æ—¶å°†æµ‹è¯•ç”¨ä¾‹å…¨éƒ¨å†™å¥½ï¼Œæµ‹è¯•ç”¨ä¾‹çš„æ•°é‡å’Œå†…å®¹éƒ½æ˜¯å›ºå®šçš„ï¼Œæ— æ³•åŠ¨æ€è°ƒæ•´ã€‚é™æ€æµ‹è¯•å¯ä»¥ä½¿ç”¨@Testæ³¨è§£è¿›è¡Œç¼–å†™å’Œæ‰§è¡Œã€‚

åŠ¨æ€æµ‹è¯•æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹çš„æµ‹è¯•æ–¹æ³•ã€‚æµ‹è¯•ç”¨ä¾‹çš„æ•°é‡å’Œå†…å®¹æ˜¯åœ¨è¿è¡Œæ—¶æ ¹æ®éœ€è¦åŠ¨æ€ç”Ÿæˆçš„ã€‚åŠ¨æ€æµ‹è¯•é€šå¸¸ä½¿ç”¨å‚æ•°åŒ–æµ‹è¯•ã€æµ‹è¯•å·¥å‚å’Œæµ‹è¯•æ¨¡æ¿ç­‰æŠ€æœ¯å®ç°ã€‚åŠ¨æ€æµ‹è¯•å¯ä»¥ä½¿ç”¨JUnit5çš„åŠ¨æ€æµ‹è¯•åŠŸèƒ½@TestFactoryè¿›è¡Œç¼–å†™å’Œæ‰§è¡Œã€‚

å› ä¸ºåŠ¨æ€æµ‹è¯•å¯ä»¥åŠ¨æ€ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ï¼Œå› æ­¤å¯ä»¥æµ‹è¯•æ›´å¤šçš„æµ‹è¯•ç”¨ä¾‹ï¼Œå¢åŠ æµ‹è¯•è¦†ç›–ç‡ã€‚åŒæ—¶ï¼ŒåŠ¨æ€æµ‹è¯•è¿˜å¯ä»¥å‡å°‘æµ‹è¯•ä»£ç çš„ç¼–å†™é‡ï¼Œæé«˜æµ‹è¯•æ•ˆç‡ã€‚

åŠ¨æ€æµ‹è¯•çš„æ–¹æ³•æœ¬èº«ä¸æ˜¯æµ‹è¯•ç”¨ä¾‹ï¼Œè€Œ**æ˜¯æµ‹è¯•ç”¨ä¾‹çš„å·¥å‚**ã€‚æ‰€ä»¥å¾—åˆ°ç»“è®ºï¼šåŠ¨æ€æµ‹è¯•æ˜¯å·¥å‚çš„äº§ç‰©ã€‚

### æ—¶æœºä¸åŒ

**åŠ¨æ€æµ‹è¯•ã€ŒDynamicTestã€ä¸æ”¯æŒç”Ÿå‘½å‘¨æœŸå›è°ƒ**ã€‚å³ï¼šåŠ¨æ€æµ‹è¯•ã€ŒDynamicTestã€ä¸ä¼šæ‰§è¡Œ @BeforAll ã€@BeforeEach @AfterEach ã€@AfterAll æ–¹æ³•çš„å›è°ƒã€‚

åŠ¨æ€æµ‹è¯•çš„æ‰§è¡Œç”Ÿå‘½å‘¨æœŸä¸æ ‡å‡†çš„@Testæƒ…å†µå®Œå…¨ä¸åŒã€‚

å…·ä½“è€Œè¨€ï¼Œä¸ªåˆ«åŠ¨æ€æµ‹è¯•æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸå›è°ƒã€‚è¿™æ„å‘³ç€@BeforeEachå’Œ@AfterEachæ–¹æ³•åŠå…¶ç›¸åº”çš„æ‰©å±•å›è°ƒå‡½æ•°æ˜¯ä¸º@TestFactoryæ–¹æ³•æ‰§è¡Œï¼Œè€Œä¸æ˜¯å¯¹æ¯ä¸ªåŠ¨æ€æµ‹è¯•æ‰§è¡Œã€‚

æ¢å¥è¯è¯´ï¼Œå¦‚æœä»ä¸€ä¸ªlambdaè¡¨è¾¾å¼çš„æµ‹è¯•å®ä¾‹ä¸­è®¿é—®åŠ¨æ€æµ‹è¯•çš„å­—æ®µï¼Œè¿™äº›å­—æ®µå°†ä¸ä¼šç”±åŒä¸€ä¸ª@TestFactoryæ–¹æ³•ç”Ÿæˆçš„å„ä¸ªåŠ¨æ€æµ‹è¯•ä¹‹é—´çš„å›è°ƒæ–¹æ³•æˆ–æ‰©å±•é‡ç½®ã€‚

## å£°æ˜

1. åŠ¨æ€æµ‹è¯•çš„æ–¹æ³•ä¸Šå£°æ˜å¿…é¡»æœ‰ @TestFactory æ³¨è§£ã€‚

2. dynamicTest()æ–¹æ³•ç”± **æ˜¾ç¤ºåç§°**ã€ŒDisplayNameã€å’Œ **åŠ¨æ€æµ‹è¯•çš„å®ç°**ã€ŒExecutableã€ ç»„æˆã€‚ï¼ˆExecutableæ˜¯@FunctionalInterfaceï¼‰

## è¿”å›å€¼ç±»å‹

@TestFactoryæ³¨è§£ç”¨äºæ”¯æŒåŠ¨æ€æµ‹è¯•ï¼Œè€Œè¿”å›å€¼ç±»å‹æ˜¯ç”¨äºç¡®å®šæµ‹è¯•å·¥å‚æ–¹æ³•è¿”å›çš„åŠ¨æ€èŠ‚ç‚¹ç±»å‹çš„ã€‚

@TestFactoryæ³¨è§£å¿…é¡»è¿”å›ä¸€ä¸ª **Stream**ã€**Iterable**ã€**Iterator** æˆ– **DynamicNode**å¯¹è±¡ã€‚

è¿™äº›è¿”å›ç±»å‹çš„å«ä¹‰å¦‚ä¸‹ï¼š

### Streamã€Iterable

è¿™ä¸¤ä¸ªç±»å‹éƒ½è¡¨ç¤ºä¸€ç»„åŠ¨æ€æµ‹è¯•èŠ‚ç‚¹çš„é›†åˆã€‚

æµ‹è¯•æ–¹æ³•å¯ä»¥è¿”å›ä¸€ä¸ªStreamæˆ–Iterableå¯¹è±¡ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªåŠ¨æ€èŠ‚ç‚¹ã€‚è¿™äº›èŠ‚ç‚¹å¯ä»¥æ˜¯DynamicTestã€DynamicContaineræˆ–è‡ªå®šä¹‰çš„DynamicNodeå¯¹è±¡ã€‚

### Iterator

Iteratorç±»å‹ä¸Streamå’ŒIterableç±»ä¼¼ï¼Œä½†æ˜¯è¿”å›çš„æ˜¯ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ã€‚

æµ‹è¯•æ–¹æ³•å¯ä»¥è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œè¿­ä»£å™¨ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªåŠ¨æ€èŠ‚ç‚¹ã€‚

### DynamicNode

![](assets/20230419105850.png)


DynamicNodeæ¥å£æ˜¯è¡¨ç¤ºå¯åŠ¨æ€åˆ›å»ºæµ‹è¯•èŠ‚ç‚¹çš„æ¥å£ã€‚åŠ¨æ€æµ‹è¯•æ–¹æ³•å¯ä»¥è¿”å›ä¸€ä¸ªDynamicNodeå¯¹è±¡ï¼Œå®ƒå¯ä»¥æ˜¯DynamicTestã€DynamicContaineræˆ–è‡ªå®šä¹‰çš„DynamicNodeå¯¹è±¡ã€‚

DynamicNodeçš„å¯å®ä¾‹åŒ–çš„å­ç±»æ˜¯ **DynamicContainer** å’Œ **DynamicTest** ã€‚

DynamicContainerå®ä¾‹ç”±ä¸€ä¸ª**æ˜¾ç¤ºåç§°**å’Œä¸€ä¸ª**åŠ¨æ€å­èŠ‚ç‚¹åˆ—è¡¨**ã€ŒIterableæˆ–DynamicNodeæµã€ç»„æˆï¼Œå¯ä»¥åˆ›å»ºä»»æ„åµŒå¥—çš„åŠ¨æ€èŠ‚ç‚¹å±‚æ¬¡ç»“æ„ï¼Œåœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„å®¹å™¨ã€‚

DynamicTestå®ä¾‹å°†è¢«å»¶è¿Ÿæ‰§è¡Œï¼Œä»è€Œå®ç°æµ‹è¯•ç”¨ä¾‹ä¾æ®éç¡®å®šæ€§çš„åŠ¨æ€ç”Ÿæˆã€‚

DynamicNodeæ¥å£æä¾›äº†è®¸å¤šæ–¹æ³•ï¼Œç”¨äº**è®¾ç½®èŠ‚ç‚¹åç§°**ã€**æè¿°**ã€**æ ‡è®°**ã€**åµŒå¥—**ç­‰ä¿¡æ¯ã€‚


å¦‚æœä¸è¿”å›ä»¥ä¸Šç±»å‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

>è¿”å›å…¶å®ƒç±»å‹æŠ¥é”™ï¼šJUnitExceptionã€‚å› ä¸ºç¼–è¯‘æ—¶æ— æ³•æ£€æµ‹åˆ°æœ‰æ•ˆçš„è¿”å›ç±»å‹ã€‚


## æ³¨æ„âš ï¸

1. åŠ¨æ€æµ‹è¯•æœ¬è´¨æ˜¯ @TestFactory å·¥å‚æ–¹æ³•ç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹ã€‚

2. ä¸@Testæ–¹æ³•ä¸€æ ·ï¼Œ@TestFactoryæ–¹æ³•ä¸èƒ½æ˜¯privateæˆ–staticã€‚

3. åŠ¨æ€æµ‹è¯•å¯ä»¥é€‰æ‹©å£°æ˜å‚æ•°ï¼Œé€šè¿‡ **ParameterResolvers** è§£æã€‚

4. åŠ¨æ€æµ‹è¯•çš„å®ç°é€šè¿‡ **lambdaè¡¨è¾¾å¼** æˆ– **æ–¹æ³•å¼•ç”¨** æ¥å®ç°ã€‚


### åˆ›å»ºåŠ¨æ€æµ‹è¯•çš„è§„åˆ™

1. @TestFactoryæ–¹æ³•ä¸èƒ½æ˜¯ private ,staticã€‚

2. @TestFactoryæ–¹æ³•è¿”å›ç±»å‹å¿…é¡»ä¸ºï¼š Streamã€Collectionã€Iterableã€æˆ–Iteratorã€‚

3. @TestFactoryæ–¹æ³•è¿”å›å®ä¾‹å¿…é¡»ä¸ºï¼šDynamicNodeã€DynamicContainer å’ŒDynamicTestã€‚

>DynamicNodeæ˜¯DynamicContainerå’ŒDynamicTestçš„çˆ¶ç±»ã€‚


## åŠ¨æ€æµ‹è¯•ç”¨ä¾‹åˆ›å»º

ç”±é™æ€æµ‹è¯•ç”¨ä¾‹ä¿®æ”¹ä¸ºåŠ¨æ€æµ‹è¯•ç”¨ä¾‹ã€‚

![](assets/20230418173418.png)


ç”¨ä¾‹æ ‡é¢˜|ä¼˜å…ˆçº§|æµ‹è¯•æ­¥éª¤|é¢„æœŸç»“æœ|
|---|---|---|---|
1stDynamic|P0|3+2|5|
2ndDynamic|P0|125/5|5|


åŠ¨æ€æµ‹è¯•æ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡å·¥å‚æ–¹æ³•ã€Œ@TestFactoryæ³¨è§£ã€ç”Ÿæˆçš„æµ‹è¯•ã€‚

>æ ‡è®°ä¸º@TestFactory çš„æ–¹æ³•ä¸æ˜¯æµ‹è¯•ç”¨ä¾‹ï¼Œè€Œæ˜¯æµ‹è¯•ç”¨ä¾‹çš„å·¥å‚ã€‚

#### è¿”å›ç±»å‹ï¼šé›†åˆ

![](assets/20230418172228.png)

```java
public class DynamicSampleTest {
    // åˆ›å»ºåŠ¨æ€æµ‹è¯•ç”¨ä¾‹
    @TestFactory
    @DisplayName("è¿”å›ç±»å‹ä¸ºCollectioné›†åˆ")
    Collection<DynamicTest> dynamicTestsFromCollection() {
        return Arrays.asList(
                DynamicTest.dynamicTest("1stDynamic", () -> assertEquals(5, 3+2)),
                DynamicTest.dynamicTest("2ndDynamic", () -> assertEquals(5, 25/5))
        );
    }
}
```

#### è¿”å›ç±»å‹ï¼šå®ä¾‹

![](assets/20230418174902.png)


```java
//æ–¹æ³•è¿”å›å®ä¾‹ä¸ºDynamicTest
@TestFactory
@DisplayName("è¿”å›ç±»å‹ä¸ºDynamicTestå®ä¾‹")
DynamicTest dynamicTest() {
    return DynamicTest.dynamicTest("å•ä¸ªåŠ¨æ€æµ‹è¯•",
            () -> assertEquals(5, 3+2));
}
```

#### è¿”å›ç±»å‹ï¼šDynamicContainerå®¹å™¨

![](assets/20230418180155.png)

```java
@TestFactory
@DisplayName("è¿”å›ç±»å‹ä¸ºDynamicContainerå®¹å™¨")
DynamicContainer dynamicTestsFromDynamicContainer() {
    return DynamicContainer.dynamicContainer("å¤šä¸ªåŠ¨æ€æµ‹è¯•",

            Stream.of(
                    DynamicTest.dynamicTest("1ã€åŠ¨æ€å®¹å™¨",
                            () -> assertEquals(5, 3+2)),
                    DynamicTest.dynamicTest("2ã€åŠ¨æ€å®¹å™¨",
                            () -> assertEquals(5,25/5))
            ));
}
```


#### è¿”å›ç±»å‹ï¼šStreamæµ

![](assets/20230418180554.png)

```java
@TestFactory
@DisplayName("è¿”å›ç±»å‹ä¸ºStreamæµ")
Stream<DynamicTest> dynamicTestsFromStream() {
    return Stream.of(6, 8, 10)
            .map(arg -> DynamicTest.dynamicTest("Stream Dy test " + arg, () -> {
                System.out.println(arg);//6, 8, 10
                assertThat(arg, greaterThan(2));
            }));
}
```


#### è¿”å›ç±»å‹ï¼šIteratorè¿­ä»£å™¨

![](assets/20230418182312.png)

```java
@TestFactory
@DisplayName("è¿”å›ç±»å‹ä¸ºIteratorè¿­ä»£å™¨")
Iterator<DynamicTest> dynamicTestsFromIterator(){
    Collection<DynamicTest> dynamicTestIterator = new ArrayList<>();
    //åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«10ä¸ªæ•´æ•°çš„è¿­ä»£å™¨ï¼Œè¿™10ä¸ªæ•´æ•°ä»2å¼€å§‹ï¼Œæ¯ä¸ªæ•´æ•°éƒ½æ¯”å‰ä¸€ä¸ªæ•´æ•°å¤§1
    //iterate()æ–¹æ³•å¯ä»¥ç”¨äºç”Ÿæˆä¸€ä¸ªæ— é™æµï¼Œå®ƒä»ä¸€ä¸ªåˆå§‹å€¼å¼€å§‹ï¼Œç„¶åé‡å¤åº”ç”¨ä¸€ä¸ªå‡½æ•°æ¥ç”Ÿæˆåç»­çš„å€¼ã€‚
    //limit()æ–¹æ³•å¯ä»¥ç”¨äºæˆªæ–­æ— é™æµï¼Œä½¿å…¶å˜ä¸ºæœ‰é™æµã€‚è¿™é‡Œä½¿ç”¨limit(10)æ–¹æ³•å°†æ— é™æµæˆªæ–­ä¸ºåŒ…å«10ä¸ªå…ƒç´ çš„æœ‰é™æµã€‚
    PrimitiveIterator.OfInt iterator = IntStream.iterate(2, n -> n + 1).limit(10).iterator();

    while (iterator.hasNext()){
        Integer next = iterator.next();
        String displayName = "åŠ æ³•æµ‹è¯• " + next;
        dynamicTestIterator.add(
                DynamicTest.dynamicTest(displayName, () -> {
                                                    assertThat(next,greaterThan( 3));
                                                    })
        );
    }
    return dynamicTestIterator.iterator();
}
```


Iteratorå¯ä»¥è¿”å›å…·æœ‰è¿­ä»£çŠ¶æ€çš„å¯¹è±¡ï¼Œæœ‰ hasNext()/next()ã€‚

Iterableæ˜¯ä¸€ç³»åˆ—å¯ä»¥è¿­ä»£çš„å…ƒç´ ã€‚

> Javaä¸­é›†åˆä½¿ç”¨.iterator() è¿”å›å¯è¿­ä»£çš„å¯¹è±¡


#### è¿”å›ç±»å‹ï¼šIterableè¿­ä»£å™¨

![](assets/20230419105355.png)

```java
@TestFactory
@DisplayName("è¿”å›ç±»å‹Iterable")
Iterable<DynamicTest> dynamicTestsFromIterable(){
	Collection<DynamicTest> dynamicTestIterator = new ArrayList<>();
	PrimitiveIterator.OfInt iterator = IntStream.iterate(2, n -> n + 1).limit(10).iterator();

	while (iterator.hasNext()){
		Integer next = iterator.next();
		String displayName = "IterableåŠ æ³•æµ‹è¯• " + next;

		dynamicTestIterator.add(
				DynamicTest.dynamicTest(displayName,  () -> {
					System.out.println("n:" + next);
					assertThat(next,greaterThan( 3));
				}));
	}
	return dynamicTestIterator;
}

```

## åŠ¨æ€æµ‹è¯•ä¸­çš„æ‰§è¡Œé¡ºåº

åŠ¨æ€æµ‹è¯•èŠ‚ç‚¹çš„æ‰§è¡Œé¡ºåºæ˜¯ç”±JUnit 5çš„æ‰§è¡Œå¼•æ“æ§åˆ¶çš„ï¼Œå¹¶ä¸”ä¸ä¿è¯æŒ‰ç…§æ·»åŠ çš„é¡ºåºæ‰§è¡Œã€‚å…·ä½“æ¥è¯´ï¼ŒåŠ¨æ€æµ‹è¯•èŠ‚ç‚¹å¯èƒ½ä¼šåœ¨ä»»ä½•æ—¶é—´ç‚¹è¢«æ‰§è¡Œï¼Œå¹¶ä¸”å®ƒä»¬çš„æ‰§è¡Œé¡ºåºå¯èƒ½ä¼šå› ä¸ºå¤šçº¿ç¨‹æ‰§è¡Œæˆ–è€…æµ‹è¯•å¼•æ“çš„å†…éƒ¨æœºåˆ¶è€Œå‘ç”Ÿå˜åŒ–ã€‚

ä¸ºäº†ä½¿æµ‹è¯•ç»“æœæ›´åŠ ç¨³å®šå’Œå¯é¢„æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†åŠ¨æ€æµ‹è¯•èŠ‚ç‚¹çš„è¾“å…¥å‚æ•°æŒ‰ç…§ç‰¹å®šçš„é¡ºåºæ’åˆ—æ¥æ§åˆ¶æµ‹è¯•çš„æ‰§è¡Œé¡ºåºã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Javaçš„**Comparator**æ¥å£æ¥å¯¹è¾“å…¥å‚æ•°è¿›è¡Œæ’åºï¼Œç„¶åå°†æ’åºåçš„å‚æ•°åˆ—è¡¨ä½œä¸º**DynamicTest**å¯¹è±¡çš„è¾“å…¥å‚æ•°ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¡®ä¿æµ‹è¯•ç”¨ä¾‹æŒ‰ç…§ç‰¹å®šçš„é¡ºåºæ‰§è¡Œã€‚


1. åŠ¨æ€æµ‹è¯•çš„æ–¹æ³•é¡ºåºä¸ä¾èµ–äºåœ¨é¡¶çº§æµ‹è¯•ç±»ä¸Šå£°æ˜çš„@TestMethodOrderã€‚
1. ä¸ºäº†æ§åˆ¶åŠ¨æ€æµ‹è¯•çš„é¡ºåºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰æ’åºã€‚


### å•ä¸ª

>å•ä¸ªåŠ¨æ€æµ‹è¯•æ—¶ï¼Œç›´æ¥æ§åˆ¶ä¼ å…¥çš„å‚æ•°é¡ºåºå³å¯ã€‚

**éœ€æ±‚**ï¼šå•ä¸ªdynamicTestï¼Œè‡ªå®šä¹‰åŠ¨æ€æµ‹è¯•çš„æ‰§è¡Œé¡ºåºï¼ŒæŒ‰ä¼ å…¥å‚æ•°é™åºæ‰§è¡Œã€‚

```java
@TestFactory
@DisplayName("é™åºæ‰§è¡Œ")
public Stream<DynamicTest> dynamicTestOrder() {
	Integer[] numbers = {3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5};
	Arrays.sort(numbers, Comparator.reverseOrder()); // é€†åºæ’åº

	return Arrays.stream(numbers)
			.map(number -> DynamicTest.dynamicTest("Test " + number, () -> {
				// æµ‹è¯•é€»è¾‘
				assertTrue(number > 0 && number < 10);
			}));
}

```

### å¤šä¸ª

>å¤šä¸ªåŠ¨æ€æµ‹è¯•æ—¶ï¼Œæ ¹æ®DisplayNameæ§åˆ¶é¡ºåºã€‚å¯ä»¥æ‹¿åˆ°DisplayNameå­—æ®µï¼Œåˆ‡å‰²è·å–ä¸­é—´èŠ‚ç‚¹æˆ–æ•´ä¸ªå­—æ®µè¿›è¡Œæ’åºå¯¹æ¯”ã€‚

**éœ€æ±‚**ï¼šå¤šä¸ªdynamicTestï¼Œè‡ªå®šä¹‰åŠ¨æ€æµ‹è¯•çš„æ‰§è¡Œé¡ºåºï¼ŒæŒ‰æµ‹è¯•çš„æ˜¾ç¤ºåç§°çš„é™åºæ§åˆ¶æ‰§è¡Œé¡ºåºã€‚

![](assets/20230419110434.png)

```java
@TestFactory
@DisplayName("è‡ªå®šä¹‰åŠ¨æ€æµ‹è¯•æ’åº")
Collection<DynamicTest> dynamicTestsOrder() {

	List<DynamicTest> dynamicTests = Arrays.asList(
			DynamicTest.dynamicTest("1st dynamic test", () -> {
				System.out.println("=> 1st dynamic test");
			}),
			DynamicTest.dynamicTest("2nd dynamic test", () -> {
				System.out.println("=> 2nd dynamic test");
			}),
			DynamicTest.dynamicTest("3rd dynamic test", () -> {
				System.out.println("=> 3rd dynamic test");
			})
	);

	sortDynamicTests(dynamicTests);
	return dynamicTests;
}

static void sortDynamicTests(List<DynamicTest> dynamicTests) {
	//æ ¹æ®displayNameå¯¹æ¯”æ¥å®šä¹‰æ‰§è¡Œé¡ºåº
	dynamicTests.sort((DynamicTest d1, DynamicTest d2) ->
			d2.getDisplayName().compareTo(d1.getDisplayName()));
}

```


## åŠ¨æ€æµ‹è¯•å‚æ•°åŒ–

- åœ¨å‰é¢è¿”å›å€¼ç±»å‹ä¸ºstreamçš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨çš„å‚æ•°åŒ–
>æœ¬æ¬¡ä½¿ç”¨Collectionæ¼”ç¤º

- æœ‰å¤šä¸ªIPå‚æ•°ï¼Œä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹
  - ç¬¬ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æ‰“å°ï¼š1ã€é›†åˆå‚æ•°åŒ–ï¼šipåœ°å€
  - ç¬¬äºŒä¸ªæµ‹è¯•ç”¨ä¾‹æ‰“å°ï¼š2ã€ipå‚æ•°åŒ–ï¼š--ipåœ°å€

java
public class DynamicParamsTest {
	@TestFactory
	Collection<DynamicTest> dynamicTestsFromStreamInJava8() {
		Collection<DynamicTest> dynamicTests = new ArrayList<>();
		Arrays.asList("154.174.10.56", "211.152.104.132", "178.144.120.156")
				.forEach(s -> {
					//æ¯ä¸€ä¸ªå‚æ•°è¿›è¡ŒåŠ¨æ€æµ‹è¯•ç”¨ä¾‹
					DynamicTest dynamicTest = DynamicTest.dynamicTest("1ã€é›†åˆå‚æ•°åŒ–", () -> {
						System.out.println("1ã€é›†åˆå‚æ•°åŒ–ï¼š" + s);
					});

					DynamicTest dynamicTest1 = DynamicTest.dynamicTest("2ã€é›†åˆå‚æ•°åŒ–", () -> {
						System.out.println("2ã€ipå‚æ•°åŒ–ï¼š--" + s);
					});
					dynamicTests.add(dynamicTest);
					dynamicTests.add(dynamicTest1);
				});

		return dynamicTests;
	}
}


- ä¼˜åŒ–ï¼šå¯ä»¥ç›´æ¥å¥—ç”¨åœ¨ä¸€èµ·ï¼Œå¦‚ä¸‹ï¼š

java
public class DynamicParamsTest {
    @TestFactory
    Collection<DynamicTest> dyTestCollection(){
        List<DynamicTest> dynamicTests = new ArrayList<DynamicTest>();
        Arrays.asList(6, 8, 10)
                .forEach(arg ->{

                            dynamicTests.add(
                                    dynamicTest("test" + arg,
                                            () -> {
                                                System.out.println("m:"+m);//8  14  22
                                                m +=arg;
                                                System.out.println("m+arg:"+m);//8  14  22
                                                assertThat(arg, is(greaterThan(2)));
                                            }
                                    ));
                            dynamicTests.add(
                                    dynamicTest("test-" + arg,
                                            () ->{
                                                System.out.println("m-:"+m);//8  14  22
                                                m -=arg;
                                                System.out.println("m-arg:"+m);//8  14  22
                                                assertThat(arg, is(greaterThan(2)));
                                            }
                                    ));
                            });

        return dynamicTests;
    }
}



![](https://cdn.jsdelivr.net/gh/testeru-top/images/tester/202206081952622.png)
## åŠ¨æ€æµ‹è¯•å¹¶å‘
- è¦åœ¨ Junit ä¸­å¯ç”¨å¹¶è¡Œæµ‹è¯•ï¼Œåœ¨src/test/resourcesä¸‹åˆ›å»ºjunit-platform.propertiesï¼š
properties
junit.jupiter.execution.parallel.enabled=true
junit.jupiter.execution.parallel.config.strategy=dynamic

### æŒ‡å®šåŠ¨æ€æµ‹è¯•æ–¹æ³•æ‰§è¡Œå¹¶å‘

java
public class DynamicParallelTest {
	//åŠ¨æ€æµ‹è¯•æ–¹æ³•æŒ‡å®šå¤šçº¿ç¨‹æ‰§è¡Œ
	@Execution(ExecutionMode.CONCURRENT)
	@TestFactory
	Collection<DynamicTest> parallelTest() {
		return Arrays.asList(
				dynamicTest("1st dynamic test", () -> {
					System.out.println(Thread.currentThread().getName()+" => 1st dynamic test");
				}),
				dynamicTest("2nd dynamic test", () -> {
					System.out.println(Thread.currentThread().getName()+" => 2nd dynamic test");
				}),
				dynamicTest("3rd dynamic test", () -> {
					System.out.println(Thread.currentThread().getName()+" => 3rd dynamic test");
				})
		);
	}
}


### æŒ‡å®šåŠ¨æ€æµ‹è¯•ç±»æ‰§è¡Œå¹¶å‘

java
package top.testeru.dynamic.test;

import org.junit.jupiter.api.DynamicTest;
import org.junit.jupiter.api.TestFactory;
import org.junit.jupiter.api.parallel.Execution;
import org.junit.jupiter.api.parallel.ExecutionMode;

import java.util.Arrays;
import java.util.Collection;

import static org.junit.jupiter.api.DynamicTest.dynamicTest;

/**
 * @Classname: DynamicParallelTest
 * @Description: åŠ¨æ€æµ‹è¯•çš„å¹¶å‘æµ‹è¯•
 * @Date: 2022/6/8 21:44
 * @Created by top.testeru
 */
@Execution(ExecutionMode.CONCURRENT)
public class DynamicParallelClassTest {
    //åŠ¨æ€æµ‹è¯•æ–¹æ³•æŒ‡å®šå¤šçº¿ç¨‹æ‰§è¡Œ
//    @Execution(ExecutionMode.CONCURRENT)
    @TestFactory
    Collection<DynamicTest> parallelTest() {
        return Arrays.asList(
                dynamicTest("1st dynamic test", () -> {
                    System.out.println(Thread.currentThread().getName()+" => 1st dynamic test");
                }),
                dynamicTest("2nd dynamic test", () -> {
                    System.out.println(Thread.currentThread().getName()+" => 2nd dynamic test");
                }),
                dynamicTest("3rd dynamic test", () -> {
                    System.out.println(Thread.currentThread().getName()+" => 3rd dynamic test");
                })
        );
    }
    //åŠ¨æ€æµ‹è¯•æ–¹æ³•æŒ‡å®šä¸»çº¿ç¨‹æ‰§è¡Œ
    @Execution(ExecutionMode.SAME_THREAD)
    @TestFactory
    Collection<DynamicTest> mainTest() {
        return Arrays.asList(
                dynamicTest("1st", () -> {
                    System.out.println(Thread.currentThread().getName()+" => 1st");
                }),
                dynamicTest("2nd", () -> {
                    System.out.println(Thread.currentThread().getName()+" => 2nd");
                }),
                dynamicTest("3rd", () -> {
                    System.out.println(Thread.currentThread().getName()+" => 3rd");
                })
        );
    }

}



![](https://cdn.jsdelivr.net/gh/testeru-top/images/tester/202206082152485.png)


## æ–¹æ³•
|æ–¹æ³•å|è¯´æ˜|
|---|---|
|dynamicTest(String displayName,  Executable executable)|ä¸ºå·¥å‚æä¾›æ˜¾ç¤ºåç§°ã€æ‰§è¡Œä»£ç å—åˆ›å»ºæ–°çš„åŠ¨æ€æµ‹è¯•å·¥å‚|



#### dynamicTest()
- dynamicTest(String displayName, Executable executable)
	- displayName
		- æµ‹è¯•ç”¨ä¾‹çš„åç§°
	- executable
		- æµ‹è¯•ä»£ç å—
		- ä¸å¯ä¸ºç©º

- dynamicTest(String displayName, URI testSourceUri, Executable executable)
	- testSourceUri
		- åŠ¨æ€æµ‹è¯•çš„è‡ªå®šä¹‰æµ‹è¯•æº URIï¼›
		- å¦‚æœæ¡†æ¶åº”è¯¥åŸºäº @TestFactory æ–¹æ³•ç”Ÿæˆæµ‹è¯•æºï¼Œåˆ™å¯èƒ½ä¸º null






## 4.å±‚æ¬¡æˆ–åµŒå¥—åŠ¨æ€æµ‹è¯•ç¤ºä¾‹



DynamicTestç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œæµ‹è¯•åç§°æˆ–æ˜¾ç¤ºåç§°ï¼Œä»¥åŠä¸€ä¸ªExecutable



@TestFactoryæ–¹æ³•å‘Šè¯‰JUnitè¿™æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºåŠ¨æ€æµ‹è¯•çš„å·¥å‚ã€‚ å¦‚æˆ‘ä»¬æ‰€è§ï¼Œæˆ‘ä»¬ä»…è¿”å›DynamicTestçš„é›†åˆã€‚ æ¯ä¸ªDynamicTestéƒ½ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œå³æµ‹è¯•åç§°æˆ–æ˜¾ç¤ºåç§°ä»¥åŠä¸€ä¸ªExecutableã€‚


@TestFactoryè¿”å›Streamï¼Œåˆ™åœ¨æ‰§è¡Œæ‰€æœ‰æµ‹è¯•åå®ƒå°†è‡ªåŠ¨å…³é—­ã€‚


https://www.youtube.com/watch?v=NElF6tsLxRE&list=PLq5LPoVktQ4IG1iUPoo234tvE8yN9xIG6&index=32



## åŠ¨æ€æµ‹è¯•çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

åœ¨åŠ¨æ€æµ‹è¯•ä¸­ï¼Œ@BeforeEach å’Œ @AfterEach ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¼šé’ˆå¯¹æ¯ä¸ª @TestFactory æ–¹æ³•æ‰§è¡Œï¼Œä½†ä¸ä¼šé’ˆå¯¹æ¯ä¸ªåŠ¨æ€æµ‹è¯•æ‰§è¡Œã€‚


DynamicTest æ˜¯åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹ã€‚
å®ƒç”±æ˜¾ç¤ºåç§°å’Œå¯æ‰§è¡Œæ–‡ä»¶ç»„æˆã€‚
DynamicTest çš„å®ä¾‹å¿…é¡»ç”±å¸¦æœ‰@TestFactory æ³¨è§£çš„å·¥å‚æ–¹æ³•ç”Ÿæˆã€‚
è¯·æ³¨æ„ï¼ŒåŠ¨æ€æµ‹è¯•ä¸æ ‡å‡† @Test ç”¨ä¾‹å®Œå…¨ä¸åŒï¼Œå› ä¸ºåŠ¨æ€æµ‹è¯•ä¸ä¼šæ‰§è¡Œè¯¸å¦‚ @BeforeEach å’Œ @AfterEach æ–¹æ³•ä¹‹ç±»çš„å›è°ƒã€‚





-  DynamicNode æ”¯æŒçš„å­ç±»åŒ…æ‹¬ DynamicContainer å’Œ DynamicTestã€‚åŠ¨æ€æµ‹è¯•å°†å»¶è¿Ÿæ‰§è¡Œï¼Œæ”¯æŒåŠ¨æ€ç”šè‡³éç¡®å®šæ€§çš„æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆã€‚
@TestFactory è¿”å›çš„ä»»ä½• Stream éƒ½å°†é€šè¿‡è°ƒç”¨ stream.close() æ­£ç¡®å…³é—­ï¼Œä»è€Œå¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ Files.lines() ç­‰èµ„æºä½œä¸ºæµçš„åˆå§‹æºã€‚
@TestFactory æ–¹æ³•å¯ä»¥é€‰æ‹©å£°æ˜è¦ç”± ParameterResolvers è§£æçš„å‚æ•°ã€‚
æµ‹è¯•æ‰§è¡Œé¡ºåº
é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†ä½¿ç”¨ç¡®å®šæ€§ä½†æ•…æ„ä¸æ˜æ˜¾çš„ç®—æ³•å¯¹æµ‹è¯•æ–¹æ³•è¿›è¡Œæ’åºã€‚è¿™ç¡®ä¿äº†æµ‹è¯•å¥—ä»¶çš„åç»­è¿è¡Œä»¥ç›¸åŒçš„é¡ºåºæ‰§è¡Œæµ‹è¯•æ–¹æ³•ï¼Œä»è€Œå…è®¸å¯é‡å¤çš„æ„å»ºã€‚åœ¨æ­¤ä¸Šä¸‹æ–‡ä¸­ï¼Œæµ‹è¯•æ–¹æ³•æ˜¯ä½¿ç”¨@Testã€@RepeatedTestã€@ParameterizedTestã€@TestFactory æˆ–@TestTemplate ç›´æ¥æ³¨é‡Šæˆ–å…ƒæ³¨é‡Šçš„ä»»ä½•å®ä¾‹æ–¹æ³•ã€‚
å°½ç®¡çœŸæ­£çš„å•å…ƒæµ‹è¯•é€šå¸¸ä¸åº”ä¾èµ–äºå®ƒä»¬çš„æ‰§è¡Œé¡ºåºï¼Œä½†æœ‰æ—¶éœ€è¦å¼ºåˆ¶æ‰§è¡Œç‰¹å®šçš„æµ‹è¯•æ–¹æ³•æ‰§è¡Œé¡ºåºâ€‰-â€‰ä¾‹å¦‚ï¼Œåœ¨ç¼–å†™é›†æˆæµ‹è¯•æˆ–åŠŸèƒ½æµ‹è¯•æ—¶ï¼Œæµ‹è¯•çš„é¡ºåºæ˜¯é‡è¦ï¼Œå°¤å…¶æ˜¯ä¸ @TestInstance(Lifecycle.PER_CLASS) ç»“åˆä½¿ç”¨ã€‚
