---
title: Performance Test Process
date: 2022-09-15 00:22:47.341
updated: 2022-09-15 08:26:24.972
url: /archives/performance04
categories: 
- jmeter
tags: 
- jmeter
---

# 性能测试流程
## 性能测试流程
一般来说，一个完整的性能测试流程应该包含以下步骤：

#### 性能需求分析
- 前期分析：所谓前期分析就是指在正式开展性能测试工作之前，我们对于被测系统的一个分析、收集信息的工作。

通常来说，前期分析可以分为三个部分：**系统分析**、**业务分析**、**需求分析**。

##### 系统分析
系统分析是指从整个系统层面，对被测系统的类型、架构设计、开发选型、部署落地、与第三方系统的关系等所作的一个全面的分析工作。
###### 分析被测系统的类型：
通常来说，被测系统、子系统、模块我们都可以将之分为两种类型：

**偏CPU计算类型**：是指被测系统的业务是偏向于CPU的计算、处理，即需要做复杂的业务逻辑计算和处理的业务。
通常来说，一些常见的功能接口，都是偏向于CPU计算类型。
**偏IO损耗类型**：是指被测系统的业务是偏向于磁盘读写、数据库读写，主要的压力来源于磁盘IO、内存、带宽等资源的损耗。





分析被测系统的架构设计：
		相关的资源：
		·项目设计文档
		·概要设计、详细设计文档
		·架构设计图
		·网络拓扑结构图
		
		对于系统架构设计的分析，主要是帮助我们对整个系统的架构、设计有一个清晰的认知。
			·了解系统的设计分解、模块和模块、子系统和子系统之间的关系。
			·了解业务和设计的相关性，从设计角度去理解业务的流转，并且弄清楚相关的模块和影响。

	·分析被测系统的开发选型：
		·开发语言的选择。
		·开发的框架选型。
		·通信协议等。

	·分析被测系统的部署、落地情况：
		·根据网络拓扑结构图，将设计中的单元和实际的服务器对应起来。
		·根据具体的服务器、服务器软件去了解、准备相应的监控准备。
		·为性能测试环境搭建、配置优化做准备。

	·分析被测系统和第三方系统的关联：
		·是否存在和第三方系统的关联。
		·如果有第三方系统的关联，则要分析其影响的模块、子系统和业务。
			在性能测试过程中，必要时要对其进行隔离处理。
			一般的隔离措施：
			·测试桩：又叫挡板处理、mock处理等。


·业务分析：业务分析主要是通过分析确定待测业务和不测业务，分析待测业务的特征等。
	·待测业务和不测业务的分析：
	理论上来说，所有业务都要做性能测试，但是实际工作中，因为时间的缘故，我们需要根据优先级去确定待测和不测业务。
		优先级又分为功能和性能两个维度：
		·功能：功能优先级来源于设计和需求文档。
		·性能：性能的优先级的划分很简单，使用次数、频次越高的业务，优先级越高。
			通常来说，根据2/8原则，80%的时间，用户都在使用20%的功能。
		
	·分析待测业务：
		·分析业务的流程、数据走向。
			如果一个系统中有N个待测业务，则至少要有N个脚本。
	
		·分析业务的业务特征。涉及到用户的使用习惯、使用场景等。

		·分析业务的数据特征。

·需求分析：分析、收集、整理测试需求相关的数据、获取和确定性能测试需求。
	·一般来说，我们主要要获取和确定的性能测试需求是：
		·响应时间：
		·tps：每秒事务数，即系统每秒钟能够处理完成的事务数量。

		PS：衡量一个系统的处理能力，并不是通过并发用户来实现，而是通过tps来实现。对于并发用户数这样的概念来说，是通过测试获取，而不是通过设置、设定来实现。
		系统所支持的并发=TPS*平均响应时间。

	·需求的获取来源：
		·客户
		·生产数据
		·同类竞品
		·资深业务
		·资深开发（跳槽来的）

	·需求的分析：
		·响应时间：
			不同的业务响应时间的要求是不一样的。
			对于响应时间来说，一般要遵循2/5/8原则。

		PS：在和用户商定响应时间的数据时，建议响应时间越大越好。

		·tps：这个数据一般是没有的，我们能够获取到的仅仅是PV或者类似的数据。
		PV：Page View,页面访问，通常来说类似的就是特定时间段内业务被请求的次数。
		数据粒度越小越好，跨度越大越好。
	
		怎么换算呢？
		1、根绝业务特征、根据数据粒度去确定平均或者最大的tps。

		2、如果没有更多的数据、信息支撑，我们可以简单的根据2/8原则进行tps的估算。
		tps=(总请求数*80%)/(总时间×20%)	
		
	
#### 制定测试计划
制定性能测试计划
#### 编写测试方案
编写性能测试方案
#### 搭建测试环境
性能测试环境搭建
#### 脚本开发
性能测试脚本的编写
#### 构造测试数据
性能测试数据的准备
#### 执行测试
性能测试场景的设计、实现、执行
监控的实现
#### 结果分析
性能测试结果、监控数据的汇总、分析
#### 性能调优
定位性能瓶颈、提出调优建议
#### 回归测试
#### 测试报告
性能测试报告编写
















·脚本增强：通常来说，不论是录制还是抓包所生成的脚本，不足以满足性能测试的需求，我们需要对脚本进行适当的增强处理。常见的脚本增强处理有：
	·参数化：
	·关联：
	·事务：
	·检查点：
	·思考时间：
	·集合点：


·参数化：参数化是为了实现不同用户的不同请求的模拟效果。
	参数化最终实现的效果：
		·逻辑相同，数据不同。

·什么时候？为什么需要做参数化？
	·功能：对于性能测试来说，功能要求主要是指服务器对于数据有唯一性要求的情况。

	·性能：通常来说，服务器对于查询类的业务都会有缓存机制来改善查询业务的性能。那么在实际测试过程中，我们需要对查询的关键字进行参数化，否则就会出现大量的重复使用缓存的情况，会导致实际测试的结果比生产环境的结果要好。
	PS：
		·不触发服务器端or数据库端的缓存情况，通常要求较多的参数数据。
		·保持和生产环境下的缓存使用率的测试情况。

·参数化的实现方式：
	一般来说，不论是何种性能测试工具，参数化的实现方式本质上有两种：
	·函数方式：通过工具内建或者自定义的、扩展的函数来生成参数值。
		参数值的生成是满足特定的规律，但不是特定的值。

	·文件方式：由用户自己来建立和维护参数文件，参数文件存放的就是参数值。然后通过工具去读取参数文件中的参数值。
		参数值往往都是来源于数据库的数据。
	

·参数化的注意事项：
	·参数值的选取，要满足功能测试的限制。
		通常来说功能测试对于测试有：长度、类型、格式、合法性的要求。

	·参数值的选项要遵循等价原则。避免选择海量的数据，导致负载机的内存不足，影响测试。

	·参数值的选择要避免所见即所得。

	·对于查询类的业务，参数值的数量取决于我们希望模拟的的缓存命中率。

	·要考虑参数的取值方式对测试结果的影响。


·脚本增强：通常来说，不论是录制还是抓包所生成的脚本，不足以满足性能测试的需求，我们需要对脚本进行适当的增强处理。常见的脚本增强处理有：
	·参数化：
	·关联：
	·事务：
	·检查点：
	·思考时间：
	·集合点：

·关联：关联是用来解决请求之间的依赖。

·什么是请求之间的依赖？
	从http协议或者所有的通信协议角度来说，请求本身是一个孤立的行为。
	但是从业务角度来说，我们要去完成某些业务时，系统会要求我们先进行前置性的业务。
	请求之间的依赖是通过数据来建立的，过程是：
	请求A发送给服务器，服务器会返回一些特定的数据给客户端。
	请求B发送给服务器时，要携带请求A所获取到的特定的数据，用来向服务器证明已经完成了请求A操作。
	这种情况下，我们就说请求B依赖于请求A。

·为什么要做关联呢？
	·请求之间本身存在依赖关系。

	·脚本和真实客户端的区别。
	一般来说，我们的客户端会去解析执行前端的脚本（系统设计的一部分），前端脚本就具备获取、加工、使用依赖数据的能力。
	脚本：不论是录制还是抓包生成的脚本，在没有处理之前都是“静态”的。
	对于服务器动态返回的数据，是不具备动态响应的能力的。

	而关联操作其实就是要去模拟实现客户端获取、加工、使用依赖数据的功能。

·关联的本质：抛开业务和工具而言，关联从操作上来说，只需要完成两件事情：
	·先存：先将服务器返回的特定的动态数据保存。
	·后用：在需要用到动态数据的地方调用所保存的数据。

·关联的数据的本质：
	·需要关联处理的数据的来源一定是服务器。
	·数据一定要在后续的请求中被用到。
	·数据一定是动态变化的。
		通常变化又分为两种情况：
		·请求不变的时候，服务器响应的数据也会发生改变。
		·请求数据不变的时候，服务器响应的数据也不会发生改变。

·关联的实现：手动关联的实现，一般是通过对比法、追溯法等方法去解决脚本中的数据依赖。

步骤：
第一步：找出出错的请求。
	·原理：在进行脚本处理的过程中，如果脚本没有出错，则不需要考虑关联。
	·理解：什么是出错？
		所谓出错并不是说脚本运行一定要出现error，而是指脚本运行没有达到预期的功能目标。
	·了解：一般来说，出错的请求往往是使用非get方法的请求。
	
第二步：找出可疑数据。
	·原理：脚本出错，在排除业务数据本身的因素之后，基本上都是因为依赖数据导致的。
	·理解：可疑数据，此时我们只能根据关联、关联数据的特征来初步筛选出可能导致脚本出错的数据。

	·了解：通常来说，请求头、请求主体、URL地址参数中都有可能携带数据。

	·技巧：通常来说，我们可以根据以下规则去找出可疑数据。
		·业务：
		·键的名称：
		·值：通常来说，用来建立依赖的值不会很简单，都是“又长又臭”。


第三步：找出可疑数据的来源。
	·原理：脚本中的数据，除了用户自己选择、输入的数据，其它影响脚本业务的数据必然是从服务器返回。这就意味着可疑数据一定可以找到来源。

	·方法：可以通过抓包工具，重新去抓一次完整的流程，然后查找数据。
		LR中提供了Generation log，它按照时序记录了录制脚本过程的所有数据。

	·注意事项：查找数据来源时，一定只要查找数据本身，而不要携带数据的格式。

PS：以上三步重要的并不是步骤，而是我们要解决的问题。

第四步：保存数据。
	操作：切换到tree模式，确保是在recording snapshot,http view下。
	      ·从上往下查找可疑数据本身。
	      ·从左侧脚本树中的第一个请求（主请求）开始，在右侧的http view中找到第三步相同路径的请求。
	      ·在response body中查找可疑数据本身，第一次找到之后，直接右键--Create Parameter。
	      ·双击左侧脚本树中自动生成的关联函数，对之进行必要的修改。
			·参数名称建议有意义。
			·左右边界如果有乱码，则做如下处理：
				如果左边界有乱码，则将乱码及乱码左边的字符串删除。
				如果右边界有乱码，则将乱码及乱码右边的字符串删除。


第五步：使用数据。
	操作：切换到script模式，将脚本中的可疑数据全部替换为参数。
		CTRL+H表示查找替换。
		参数是参数的调用格式。


作业：
1、phpwind论坛的登录发贴，实现不同账号登录发贴。
2、discuz论坛的登录发贴。
3、LR自带订票网站的登录脚本。
4、LR自带订票网站，实现订票脚本，要求对出发和目的地进行参数化。












    
#### 性能需求分析
#### 制定测试计划
#### 编写测试方案
- 用例
#### 搭建测试环境
#### 构造测试数据
#### 脚本开发
#### 执行测试
#### 结果分析/测试报告
#### 性能调优

### 脚本开发前准备工作
- 充分理解系统业务「关键功能场景手工跑一遍，解决业务，导出性能测试场景」
- 充分理解系统环境「测试环境自己搭建」
- 充分理解系统通信协议「抓包复现」
以上步骤解决：
从功能测试用例 -> 性能测试脚本开发的准备工作