## Allure2 报告中添加附件-日志


在测试过程中，有时候需要记录测试的详细信息，比如请求参数、响应结果、异常堆栈等信息。这些信息可以通过日志来记录，然后将日志作为附件添加到测试报告中，方便查看和分析。

### 应用场景

Allure报告添加日志附件的使用场景有两种：

##### 1.添加测试方法中的日志附件

可以将测试方法中的错误信息和异常堆栈信息保存为日志附件。

##### 2.添加测试框架的日志附件：

可以通过测试框架的日志配置，将框架输出的日志保存为日志附件，例如在使用`Logback`作为测试框架的日志组件时，可以通过配置`Logback`的`appender`将日志输出到指定的文件中，然后将该文件作为日志附件添加到`Allure`报告中。


## 添加日志的方式

1. 在测试方法中添加`@Attachment`注解。


2. 使用`Allure.addAttachment()`方法。

### 注解方式添加

#### 语法结构

```java
@Attachment(value = "日志名", type = "text/plain", fileExtension = "后缀")
```


#### String类型添加日志

1. 声明要添加的文件。

2. 文件内容读取为字符串。

3. 调用注解方法，传入字符串参数。

```java
@DisplayName("注解方法 - 文本添加验证")
@Test
public void testAllureWithTxtAttachment() throws IOException {
    // 测试用例代码

    // 添加txt文件到Allure报告
    //1.要添加的文件
    File txtFile = new File("a.txt");
    //2.文件内容读取为str
    String txtContent = readTxtFile(txtFile);
    System.out.println("txtContent:"+txtContent);
    //3.添加到注解中
    attachTxtFile(txtContent);
}
@Attachment(value = "text文本添加", type = "text/plain")
public static String attachTxtFile(String txtContent) {
    return txtContent;
}

public static String readTxtFile(File txtFile) throws IOException {
    try (BufferedReader reader = new BufferedReader(new FileReader(txtFile))) {
        StringBuilder sb = new StringBuilder();
        String line;
        while ((line = reader.readLine()) != null) {
            sb.append(line);
            sb.append(System.lineSeparator());
        }
        return sb.toString();
    }
}

```



![](https://cdn.jsdelivr.net/gh/TesterDevSoul/pic/manual/20230317163822.png)

#### byte[]类型添加日志

```java
@Test
@DisplayName("Example Test")
public void exampleTest() throws IOException {
    // Perform test actions...

    // Attach a text file to the report.
    byte[] contents = Files.readAllBytes(Paths.get("a.txt"));
    attachTextFile(contents, "byte数组文本添加");
}

@Attachment(value = "{attachmentName}", type = "text/plain")
public byte[] attachTextFile(byte[] contents, String attachmentName) {
    return contents;
}
```

![](https://cdn.jsdelivr.net/gh/TesterDevSoul/pic/manual/20230317163904.png)

### 调用方法添加

#### 语法结构

```java
public static void addAttachment(String name, String type, InputStream stream, String... testNames){

}
```



#### String类型添加日志
```java
@DisplayName("String类型添加日志")
@Test
public void testAllureWithTxtAttachment() throws IOException {
    // 测试用例代码
    // 添加txt文件到Allure报告
    //1.要添加的文件
    File txtFile = new File("a.txt");
    //2.文件内容读取为str
    String txtContent = readTxtFile(txtFile);
    Allure.addAttachment("String类型的文本添加", "text/plain", txtContent);
}
public static String readTxtFile(File txtFile) throws IOException {
    try (BufferedReader reader = new BufferedReader(new FileReader(txtFile))) {
        StringBuilder sb = new StringBuilder();
        String line;
        while ((line = reader.readLine()) != null) {
            sb.append(line);
            sb.append(System.lineSeparator());
        }
        return sb.toString();
    }
}
```
![](https://cdn.jsdelivr.net/gh/TesterDevSoul/pic/manual/20230317173719.png)


#### InputStream类型添加日志
```java
@Test
@DisplayName("InputStream类型添加日志")
public void exampleTest() throws IOException {
    Allure.addAttachment( "InputStream的文本添加","text/plain",
            Files.newInputStream(Paths.get("a.txt")), "txt");
}
```
![](https://cdn.jsdelivr.net/gh/TesterDevSoul/pic/manual/20230317173734.png)
