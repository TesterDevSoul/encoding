## Allure2 报告中添加附件-图片


### 应用场景

#### 1.添加测试用例步骤中的截图

如果测试用例执行过程中需要截图，可以通过代码将截图作为附件添加到Allure报告中。

#### 2.添加测试用例失败时的截图

如果测试用例执行失败，可以在失败重试机制中重新执行测试用例，然后将失败时的截图作为附件添加到Allure报告中。

#### 3.添加测试用例的预期结果截图

如果测试用例执行过程中需要与预期结果进行比较，可以将预期结果的截图作为附件添加到Allure报告中。


以上场景中都可以通过Allure的@Attachment注解和Allure.addAttachment()方法来添加图片附件，具体的实现方式可以根据需要选择。

## 添加图片的方式

1. 在测试方法中添加`@Attachment`注解。


2. 使用`Allure.addAttachment()`方法。

### 注解方式添加

#### 语法结构

```java
@Attachment(value = "图片名", type = "image/png", fileExtension = "后缀")
```


#### 

```java
    @Test
    @DisplayName("png图片")
    public void exampleTest() throws IOException {
        byte[] contents = Files.newInputStream(Paths.get("allure1.jpg"))
                .readAllBytes();
        attachPngFile(contents,"图片添加");
    }
    @Attachment(value = "{attachmentName}", type = "image/png")
    private byte[] attachPngFile(byte[] contents, String attachmentName) {
        return contents;

    }

```

![](https://cdn.jsdelivr.net/gh/TesterDevSoul/pic/manual/20230317183618.png)

### 调用方法添加

#### 语法结构

```java
public static void addAttachment(String name, String type, InputStream stream, String... testNames){

}
```

```java
@Test
public void testWithImageAttachment() throws IOException {
    // 添加图片附件
    Allure.addAttachment("Screenshot", "image/png",
            Files.newInputStream(Paths.get("allure")), ".png");
}
```

![](https://cdn.jsdelivr.net/gh/TesterDevSoul/pic/manual/20230317181254.png)





`Allure.addAttachment()`方法将该文件作为附件添加到`Allure`报告中。

- 第一个参数“Screenshot”是附件的名称。
- 第二个参数“image/png”是附件的MIME类型。
- 第三个参数是包含附件内容的字节数组。
- 最后一个参数“.png”指定了文件的扩展名。

这些参数共同构成了@Attachment注解的语法结构，使我们可以方便地将各种类型的附件添加到Allure报告中。



## 图片裂原因

如果在 Allure 报告中上传的图片出现了裂图或者损坏的情况，可能是因为以下原因：

1. 图片上传过程中出现了网络中断或者传输过程中出现了错误，导致图片上传不完整或者损坏。

2. Allure 报告中的图片大小超过了 Allure 的限制。默认情况下，Allure 对上传的文件大小有限制，如果上传的文件大小超过了限制，Allure 可能会对文件进行压缩，从而导致图片质量下降。

3. 图片本身存在问题，比如图片格式不被支持，或者图片文件本身存在损坏等问题。

为了解决以上问题，你可以尝试以下方法：

1. 重新上传图片。如果网络不稳定或者上传过程中出现了错误，可能需要重新上传图片，确保图片上传完整且不损坏。

2. 调整图片大小。尝试调整图片大小，确保图片大小不超过 Allure 的限制，避免出现压缩导致质量下降的情况。

3. 检查图片格式和文件本身。确保图片格式被 Allure 支持，检查图片文件本身是否存在损坏等问题。如果图片本身存在问题，可以尝试使用其他图片替换原来的图片。