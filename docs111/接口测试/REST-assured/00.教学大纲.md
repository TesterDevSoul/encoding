# 接口自动化介绍
## 课程目标
1.  接口介绍及分类
1.  接口测试介绍
1.  接口自动化介绍
1.  自动化对比
1.  接口自动化测试流程
## 接口


### 什么是接口？
   
![](https://cdn.jsdelivr.net/gh/TesterDevSoul/pic/manual/202208161128197.png)

>有输入参数和输出内容的，并且有一套有逻辑处理单元
- 输入 ---> 处理 ---> 输出

`REST API` 充当 **数据库** 和 **客户端** 之间的通信媒介。

当客户端通过 `API` 发送数据时，它会通过逻辑代码最后进入数据库，进行相应的操作（如添加、删除、修改等）并返回包含 **响应代码**、**头文件**、**cookie** 等的响应数据。
### 接口的分类

接口根据提供的对象不同分为： **内部接口** 和 **外部接口** 【相对于内部接口而存在的一个概念】。
#### 内部接口
公司内部各个服务之间发送的请求接口。

#### 外部接口
公司暴露出来给第三方的接口。


>比如从京东购物，我们会在京东app上面选择商品，然后加入购物车，再下订单，那这个过程就是京东自己各个模块调用自己内部的接口。
>但是，当付款的时候跳转到支付页面，我们都知道这个页面可以选择不同的支付方式，比如：微信支付、云闪付、好友代付等等。等你完成支付流程后，再跳转回订单页，在付款的流程中，都会涉及系统对外的接口，比如说需要使用微信支付，那对应的京东就需要调第三方微信的支付接口。
>还有，比如说后期商品配送过程的物流接口，也是需要对接第三方接口。

无论是外部接口还是内部接口，在开发前都会根据已有规则约定好传入的参数及返回对象。


>约定接口会接收什么类型的数据；在处理完成后，它又会返回什么类型的数据。


## 接口测试
![](https://cdn.jsdelivr.net/gh/TesterDevSoul/pic/manual/202208171150258.png)

模拟调用方，比如 `Client` 端，通过接口通信来检测被测接口的正确性和容错性。
### Web端
假如现在测试的是一个 `Web` 端的网页：
- `Client` 端「前端页面」为浏览器
- `Server` 端为 `Web` 的服务器
- 浏览器 和 `Web` 服务之间，通过 `HTTP` 协议传输的

### App端
假如现在测试的是移动端的`APP`，比如企业微信：

- `Client` 端「前端页面」为手机上安装的 企业微信 应用
- `Server` 端为`RESTful` 格式的接口服务
- 企业微信应用前端和 `RESTful` 格式的接口服务，就是通过 `JSON` 格式的数据来传递的

>比如说，大家都用过`postman`或者`JMeter`做对应的手工接口测试，还有有些同学用过`Charles`跟`Fiddler`，这些就是测试我们的接口，看看发送的请求链接传递的参数对不对，返回值是不是预期的内容。
>在浏览器上输入`https://www.baidu.com/`，浏览器会把这个`http`请求发送给指定的后端服务，后端服务根据请求的`API`地址，来进行逻辑处理，并把处理完的接口再返回给页面，页面把结果转换出来呈现给我们变成了前端页面。

>登录、注册接口，发送`Http`请求的时候，会把在前端页面传入的参数进行一个传递，现在一般涉及到用户相关信息的都会进行加密处理。通过`Http`协议把对应的参数和路径发送给了后端服务，后端服务根据研发写的相关的业务逻辑代码进行处理，并`return`结果，后端服务把`return`的内容返回给前端。就是返回接口的响应结果，前端根据响应内容进行渲染加载，返回的结果一般都是`json`格式，有可能有状态码{200或者404}，还会有相关的message提示内容，前端最终呈现给用户。
>后端服务，现在一般都是集群式的，为了各个业务模块之间的调用，还会有中间件的内容。我们只关注发送请求的结果是否为预期的内容，至于后端服务的代码相关业务逻辑调用流转，是不需要进行关注的。
## 接口自动化
![](https://cdn.jsdelivr.net/gh/TesterDevSoul/pic/manual/202208171127214.png)

- **UI自动化** 测试其实就是 *脚本模拟点点点*
- **接口自动化** 测试其实就是 *脚本模拟浏览器（app等客户端） 向服务器发送请求调用接口的过程*

接口测试比`UI`测试要好很多，不会突然跑着跑着页面没有响应了，对应的界面卡了没有响应。

>做`UI`自动化的时候会发现，里面会有很多奇奇怪怪的毛病，对应定位没有问题，但是脚本跑的时候有时候可以点击成功，有时候没有，或者说对应的界面该跳转的时候没有跳转，等等情况。调试的过程就是比较麻烦，有可能会有没预期到的情况出现，就需要加显示等待或者其他判断来满足我们脚本的稳定性。
### 自动化对比
|                    | UI 自动化测试 | 接口自动化测试  |
| ------------------ | ------------- | --------------- |
| 成本               | ⭐️⭐️⭐️     | ⭐️             |
| 测试效率           | ⭐️⭐️        | ⭐️⭐️⭐️⭐️⭐️ |
| 用例编写效率       | ⭐️⭐️        | ⭐️⭐️⭐️⭐️⭐️ |
| 稳定性             | ⭐️⭐️⭐️     | ⭐️⭐️⭐️⭐️⭐️ |
| 自动化回归测试效率 | ⭐️⭐️⭐️     | ⭐️⭐️⭐️⭐️⭐️ |
| 测试覆盖度         | ⭐️⭐️        | ⭐️⭐️⭐️⭐️⭐️ |
| 自动生成用例成本   | ⭐️⭐️        | ⭐️⭐️⭐️⭐️⭐️ |



##### 成本
**UI自动化**，对应的前端界面发生改变，则UI自动化测试用例就需要进行更改；

**接口自动化**，一般开发写出来了接口后，对应的接口是不会进行更改的。最多只是在接口实现的业务逻辑里面进行修改。

##### 测试效率

**UI自动化**需要添加等待时间，页面的控件加载完成才能进行自动化相关的脚本操作；

**接口自动化**，直接对服务器的API进行操作，无需等待时间。

>哪怕说是同一个测试用例，对应的UI自动化脚本运行的时间要比接口自动化脚本运行的时间，至少是翻倍的。因为前端页面不只是需要等待后端的请求响应，还需要等待页面各个控件的渲染

##### 用例编写效率
**UI自动化**编写用例，需要考虑前后条件，比如，某些业务需要登录以后才能进行操作，前置自动化操作繁琐；

**接口自动化**，直接对应API接口传入相关参数即可验证业务逻辑，没有太多前置自动化操作。

##### 稳定性
**UI自动化**，对应的前端页面会根据业务的变化进行变化，不只是当前用例进行改变，有可能当前页面的元素涉及到的用例都要进行更改；

**接口自动化**，如果业务变化接口只会新增或修改业务逻辑，对应传入参数一般不会进行更改，即使是参数添加加字段的更改，也是只涉及到当前接口。


##### 自动化回归测试效率
**UI自动化**，做对应的回归测试，首先一般都是P0级别的，成本跟脚本实现的复杂难易程度在这摆着，除非有很多的人力投入进去；

**接口自动化**，可以把所有涉及到的接口都进行一个回归测试，并且，UI层无法走到的业务逻辑，在接口自动化传入对应异常参数，也可以检验异常逻辑是否正确。这就是我们对应的测试覆盖率的问题。

>比如接口测试可以测试我们接口对应传参异常报错的问题、接口测试也可以测并发场景，类似秒杀场景的时候并发逻辑的验证。

##### 自动生成用例成本
**UI自动化**，由于每个APP对应的业务特性 以及 页面的特性，对应自动生成用例脚本的成本很大；

**接口自动化**，大部分请求都是GET或者POST请求，它们传参模版是固定的，所以，自动生成用例的成本相对于UI自动化比较低。


## 接口自动化测试流程
1. 获取接口相关信息
1. 接口测试用例设计
1. 接口测试框架选择
1. 测试用例编写与维护
1. 持续集成
### 1. 获取接口相关信息
#### 1.1 接口的范围
接口自动化需要覆盖多少业务和接口
#### 1.2 接口分析
- 接口使用的协议
- 接口对应上下游依赖关系
### 2. 接口测试用例设计
- 业务用例如何模拟和覆盖
### 3. 接口测试框架选择
- 选择合适的框架进行接口自动化脚本编写
>框架的选型，脚本的编写，po的分层，自动化框架的设计、平台化，需要由浅入深一步步深入进行
### 4. 测试用例编写与维护
- 用例编写与维护更新
### 5. 持续集成
- 与Jenkins的集成测试


## 总结
1.  接口：有输入参数和输出内容的，并且有一套有逻辑处理单元
2.  接口测试：模拟调用方，通过接口通信来检测被测接口的正确性和容错性。
3.  接口自动化：脚本模拟浏览器（app等客户端） 向服务器发送请求调用接口的过程
4.  自动化对比
5.  接口自动化测试流程