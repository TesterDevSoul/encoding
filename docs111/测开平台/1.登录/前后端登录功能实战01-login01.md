---
title: 前后端登录功能实战01
date: 2022-10-24 10:47:51.145
updated: 2022-10-26 11:55:05.269
url: /archives/login01
categories: 
- vue
tags: 
- vue
- 平台
---

下面，开始我们平台的登录功能的实战。我们结合前后端，把整体的一个登录功能给大家讲解实现出来。 

# 登录

为什么要做平台的登录功能？
## 功能

测试平台是为了给公司内的一部分人使用，不是说每个人都可以进行访问使用。如果每个人都可以访问使用就会有一个问题，操作不当，或未按规则进行填写，对应测试用例及数据就错乱，导致最终测试报告不准确。

反过来说，一般，一个平台最基本的需要有账户的登录、注册功能。在账户登录成功后，还需要该账户有对应的权限管理内容，不能是每一个注册的用户都有所有的权限，需要根据注册的用户角色进行区分。
>比如：有一些用户注册的只能是对应的输入相关测试用例，有些用户是root权限，则可以对各个用户进行删除或修改权限。


- 校验身份
>用户是否存在，是否可登录，用户名、密码是否正确。

- 权限管理
>登录的用户是root权限，还是只能访问权限，还是可以增删改测试用例的权限。


## 流程
### 登录流程
![](https://cdn.jsdelivr.net/gh/testeru-top/top-images/tester/202210241355098.png)

如果是还未进行登录的用户，则在网站首页输入对应用户名、密码，点击前端页面的登录按钮，则会发送给后端对应登录请求。

后端获取到该请求后，会根据对用数据库内用户表的数据进行对比。

- 如果一致，则代表认证通过，此时生成对应的认证相关信息，把结果封装至响应体内进行返回给前端。

- 如果不一致，则代表认证失败。把对应失败的error-code码封装封装至响应体内进行返回。

前端获取到返回的结果进行解析，若认证通过，则登录成功，页面跳转，并把其中认证相关的信息保存至前端。若认证未通过，则页面不进行跳转并弹出对应提示信息。

### 登录后的业务请求流程

![](https://cdn.jsdelivr.net/gh/testeru-top/top-images/tester/202210241355097.png)

如果是登录后的请求，则需要在每个请求中包含对应的认证信息，发送给后端时，后端会进行认证信息的校验。

- 如果检验通过，则代表有权限访问，则继续访问请求的业务逻辑，并返回对应响应体。

- 若未校验通过，则代表该请求没有权限，直接返回对应error码。



## 实现步骤
![](https://cdn.jsdelivr.net/gh/testeru-top/top-images/tester/202210241418057.png)



### 初步实现
#### 登录界面初步实现


首先需要有一个登录界面，在这里我们使用vuetify来进行实现。
#### 登录路由
在有了对应vue界面后，若想要访问该界面，则需要有对应路由才可以。即，需要通过 vue的router去注册路由，注册后，则可以直接通过URL来访问登录界面。
#### 登录接口定义
前端虽然可以访问登录界面，但是对应登录的业务逻辑是在后端进行完成，则这时需要定义一下后端的登录接口，使用的是axios来定义登录接口。
#### 调用后端登录接口
定义好接口后，登录页面就可以通过登录的按钮进行操作。即，点击登录按钮来调用后端的登录接口，这样通过后端鉴权认证返回给前端结果后就可以获取到用户的token信息。

以上就实现了一个基本的登录功能。

### 权限控制
####  配置路由守卫
系统的业务页面并不是都可以直接访问，如果是没有登录的用户，是不允许进入到系统内查看其他业务页面，若直接访问，对应页面也不能正常展示。
为了满足上面的需求，我们需要在前端配置**路由守卫**。

##### 主要作用
对应页面间的跳转，需先去判断本地是否登录过，即是否有对应token。若有该token则页面根据路由规则跳转并正常展示。若不存在token信息，则强制用户跳转到登录页面，进行登录。

以上就是路由守卫的作用。





####  配置请求拦截器
访问其他的业务接口请求，都需要首先判断在请求头里是否携带对应的token信息。

那如何把token添加到每一个业务请求中？是否需要每个请求都需要手动添加？

并不是，解决方案为：**配置一个请求拦截器**。
在请求拦截器中，如果能拿到本地保存的token信息，则会自动把该token信息拼接好，然后添加至每个请求的头信息中。这样，则完成了认证信息的携带。

####  配置响应拦截器

若登录时，**用户名** / **密码**输入错误，则代表用户没有进入系统的权限，此时后端会返回对应失败的code码。前端拿到响应数据进行解析时，就需要把token信息进行擦除，以此来保证刚刚登录的错误用户不能进入系统。

那在前端如何去实现token的擦除？
解决方案：**配置一个响应拦截器**，在相应拦截器中对后端返回的响应数据的code码进行判断，若符合条件则进行token擦除操作。

以上为相关登录的实现步骤，下面开始进行对应登录功能的前端开发。

